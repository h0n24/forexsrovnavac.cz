function confirmExit(){return isAnyTaskInProgress?"Stále na pozadí ukládám soubory. Prosím počkejte cca 5 sekund.":void 0}var full_data="",last_data_ajax="",last_url="";window.onbeforeunload=confirmExit;var isAnyTaskInProgress=!1;$(document).ready(function(){function e(t){var s=$.ajax({url:"get_content.php?url="+t,method:"POST",dataType:"json"});s.done(function(t){for(var s="",n=0;n<t.length;n++){var o="";if(0===n)"."!==t[n]&&(o='<tr class="text-muted"><td class=""><a href="#" data-url="'+t[n]+'" class="select"><i class="text-muted fa fa-arrow-left">&nbsp;</i>&nbsp;předchozí složka</a></td></tr>');else{var l="",i=t[n];i=i.substring(1),t[n].match(".md$")?(l="fa-file-o",i=i.substring(0,i.length-3)):l="fa-folder",i=i.replace(/\//g," <span class='text-muted'>&rsaquo;</span> "),o='<tr><td class=""><a href="#" data-url="'+t[n]+'" class="select"><i class="text-muted fa '+l+'">&nbsp;</i>&nbsp;'+i+"</a></td></tr>"}s+=o}var r="vytvořit nový soubor",d="create_new_file";3===t[1].length&&(r="vytvořit nový jazyk",d="create_new_language"),o='<tr class="text-muted"><td class=""><a href="#" class="select '+d+'"><i class="text-muted fa fa-plus"></i>&nbsp;'+r+"</a></td></tr>",s+=o,$("#files").html(s),$("#file-preview").show(),$(".select").click(function(){if($(this).hasClass("create_new_file"))return $("#showModalNewFile").modal(),!1;if($(this).hasClass("create_new_language"))return $("#showModalNewLanguage").modal(),!1;$("#files .selected").removeClass("selected"),$(this).parent().parent().find("td").addClass("selected"),$(".fa-file").each(function(){$(this).addClass("fa-file-o").removeClass("fa-file")}),$(".selected .fa-file-o").addClass("fa-file");var t=$(this).data("url");return t.match(".md$")?a(t):e(t),last_url=t,window.location.hash=t,!1})}),s.fail(function(e,a){alert("Načítání souborů selhalo: "+a)})}function a(e){var a=$.ajax({url:"get_content.php?url="+e,method:"POST",dataType:"json"});a.done(function(a){$("#file").show(),$(".CodeMirror").remove(),$("#file").html("");var t=a.replace(/</g,"&lt;").replace(/>/g,"&gt;");$("#file").html(t),$("#web-preview").css("visibility","visible");var s=e;s.match(".md$")&&(s=s.substring(0,s.length-3)),$("#modalIframe").prop("src","http://www.forexsrovnavac.cz"+s);var n=s.substring(1,s.length);document.title=n;var o=CodeMirror.fromTextArea(document.getElementById("file"),{mode:"text/x-markdown",styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0,theme:"monokai"});o.on("change",function(a){full_data=a.getValue();var t=full_data,n=e;clearTimeout(window["ajax_"+e]),isAnyTaskInProgress=!0,window["ajax_"+e]=setTimeout(function(){$.ajax({type:"POST",url:"save_content.php",data:{header:n,data:t},success:function(e){console.log(e),$("#modalIframe").prop("src","http://www.forexsrovnavac.cz"+s),isAnyTaskInProgress=!1},error:function(e,a,t){console.log(e.status&&400===e.status?e.responseText:"Something went wrong"),isAnyTaskInProgress=!1}}),console.log('window["ajax_'+e+'"]')},3e3),last_data_ajax=window["ajax_"+e]})}),a.fail(function(e,a){alert("Načítání souborů selhalo: "+a)})}$("#file").hide();var t=window.location.hash;t=t.substring(1,t.length),t.match(".md$")?(a(t),t=t.substring(0,t.lastIndexOf("/")),e(t)):e(t),$("#showModalResponsivity label").click(function(){$("#showModalPreview").removeClass("big-computer small-computer tablet mobile").addClass($(this).children().data("selected"))}),$("#ModalNewFile_submit").click(function(t){var s=$("#ModalNewFile_name").css("color");if("rgb(255, 0, 0)"!==s&&"red"!==s){var n=($(this).button("loading"),window.location.hash);n=n.substring(2,n.length),n.match(".md$")&&(n=n.substring(0,n.lastIndexOf("/")));var o=n;n.length>2&&(o=n.substring(0,n.lastIndexOf("/")));var l=$("#ModalNewFile_name").val();l="/"+n+"/"+l+".md",n=l;var i='{{settings}}\n  "language": "'+o+'",\n  "template": 1,\n  "header": "main",\n  "meta" : {\n    "title": "",\n    "description": "",\n    "keywords": ""\n  }\n{{/settings}}\n\n# h1 nadpis stránky\n\nText stránky.\n    ';return clearTimeout(window["ajax_"+n]),isAnyTaskInProgress=!0,window["ajax_"+n]=setTimeout(function(){$.ajax({type:"POST",url:"save_content.php",data:{header:l,data:i},success:function(t){console.log(t),isAnyTaskInProgress=!1,$("#showModalNewFile").modal("toggle"),$("#ModalNewFile_submit").button("reset"),a(n);var s=n.substring(0,n.lastIndexOf("/"));e(s),setTimeout(function(){$("#files td").each(function(){$(this).find("a").data("url")===n&&($(this).parent().addClass("selected"),$(".selected .fa-file-o").addClass("fa-file"))})},125),window.location.hash=n},error:function(e,a,t){console.log(e.status&&400===e.status?e.responseText:"Something went wrong"),isAnyTaskInProgress=!1}}),console.log('window["ajax_'+n+'"]')},3e3),last_data_ajax=window["ajax_"+n],!1}}),$("#ModalNewLanguage_submit").click(function(a){function t(a){$.ajax({type:"POST",url:"create_newlang.php",data:{language:a},success:function(a){$("#showModalNewLanguage").modal("toggle"),e("#")},error:function(e,a,t){console.log(e.status&&400===e.status?e.responseText:"Something went wrong")}})}function s(e){$.ajax({type:"POST",url:"get_isdir.php",data:{directory:e},success:function(a){console.log(a),"true"===a?($("#ModalNewLanguage_alert").html("Tento jazyk již existuje, není třeba jej generovat znova, došlo by ke smazání stávajících souborů."),$("#ModalNewLanguage_alert").show()):($("#ModalNewLanguage_alert").hide(),t(e)),$("#ModalNewLanguage_submit").button("reset")},error:function(e,a,t){console.log(e.status&&400===e.status?e.responseText:"Something went wrong")}})}var n=$("#ModalNewLanguage_name").css("color");if("rgb(255, 0, 0)"!==n&&"red"!==n){$(this).button("loading");return s($("#ModalNewLanguage_name").val()),!1}})});
